<div class="app-container">
  <!-- Header -->
  <nz-card style="margin-bottom: 16px;">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
      <div>
        <h1 style="margin: 0; font-size: 20px; font-weight: 600; color: #1890ff;">
          <span nz-icon nzType="control" nzTheme="outline"></span>
          Metrónomo Maestro
        </h1>
        <p style="margin: 4px 0 0; color: rgba(0,0,0,0.45); font-size: 14px;">{{ user()?.name }}</p>
      </div>
      <button nz-button nzType="default" (click)="logout()">
        <span nz-icon nzType="logout" nzTheme="outline"></span>
        Salir
      </button>
    </div>
  </nz-card>

  <!-- BPM Display y Control Principal -->
  <nz-card class="touch-card" style="margin-bottom: 16px; text-align: center;">
    <!-- Visualización de beats -->
    <div style="display: flex; justify-content: center; gap: 8px; margin-bottom: 24px; flex-wrap: wrap;">
      @for (beat of beats(); track beat) {
        <div
          class="beat-indicator"
          [class.active]="isBeatActive(beat)"
          [class.accent]="isBeatActive(beat) && beat === 1 && metronomeState().accentFirst">
          {{ beat }}
        </div>
      }
    </div>

    <!-- BPM Grande -->
    <div class="metronome-bpm-display">{{ bpmInput() }}</div>
    <p style="color: rgba(0,0,0,0.45); margin-bottom: 24px; text-transform: uppercase; letter-spacing: 2px; font-size: 12px;">
      BPM
    </p>

    <!-- Slider de BPM -->
    <div class="bpm-slider">
      <nz-slider
        [nzMin]="40"
        [nzMax]="240"
        [(ngModel)]="bpmInput"
        (ngModelChange)="onBpmChange($event)"
        [nzMarks]="bpmMarks">
      </nz-slider>
    </div>

    <!-- Botón Play/Stop Grande -->
    <button
      nz-button
      [nzType]="metronomeState().isPlaying ? 'default' : 'primary'"
      [nzDanger]="metronomeState().isPlaying"
      nzSize="large"
      nzBlock
      class="main-control-btn"
      (click)="toggleMetronome()">
      @if (metronomeState().isPlaying) {
        <span nz-icon nzType="pause-circle" nzTheme="outline"></span>
        DETENER
      } @else {
        <span nz-icon nzType="play-circle" nzTheme="outline"></span>
        INICIAR
      }
    </button>
  </nz-card>

  <!-- Presets -->
  <nz-card class="touch-card" [nzTitle]="presetsTitle" style="margin-bottom: 16px;">
    <ng-template #presetsTitle>
      <span nz-icon nzType="star" nzTheme="outline"></span>
      Presets
    </ng-template>
    <nz-select
      nzPlaceHolder="Seleccionar preset..."
      nzSize="large"
      nzAllowClear
      style="width: 100%;"
      [(ngModel)]="selectedPreset"
      (ngModelChange)="selectedPreset() && loadPreset(selectedPreset()!)">
      @for (preset of presets(); track preset.id) {
        <nz-option [nzValue]="preset.id!" [nzLabel]="preset.name"></nz-option>
      }
    </nz-select>
  </nz-card>

  <!-- Compás -->
  <nz-card class="touch-card" [nzTitle]="timeSignatureTitle" style="margin-bottom: 16px;">
    <ng-template #timeSignatureTitle>
      <span nz-icon nzType="clock-circle" nzTheme="outline"></span>
      Compás
    </ng-template>
    <nz-segmented
      [nzOptions]="timeSignatures"
      [ngModel]="metronomeState().timeSignature"
      (nzValueChange)="onTimeSignatureChange($event)"
      nzBlock
      nzSize="large">
    </nz-segmented>
  </nz-card>

  <!-- Tipo de Sonido -->
  <nz-card class="touch-card" [nzTitle]="soundTitle" style="margin-bottom: 16px;">
    <ng-template #soundTitle>
      <span nz-icon nzType="sound" nzTheme="outline"></span>
      Tipo de Sonido
    </ng-template>
    <nz-segmented
      [nzOptions]="soundTypeOptions"
      [ngModel]="metronomeState().soundType"
      (nzValueChange)="onSoundTypeChange($event)"
      nzBlock
      nzSize="large">
    </nz-segmented>
  </nz-card>

  <!-- Acentuar Primer Tiempo -->
  <nz-card class="touch-card" style="margin-bottom: 16px;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <span style="font-size: 16px;">
        <span nz-icon nzType="check-circle" nzTheme="outline"></span>
        Acentuar primer tiempo
      </span>
      <nz-switch
        [ngModel]="metronomeState().accentFirst"
        (ngModelChange)="onAccentFirstChange($event)"
        nzSize="default">
      </nz-switch>
    </div>
  </nz-card>
</div>
